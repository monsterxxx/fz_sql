SELECT PAYMENT.PAYMENT_ID,
  PAYMENT.COMPANY,
  PAYMENT.PAYMENT_TYPE_ID,
  IIF((PAYMENT_TYPE.PAYMENT_TYPE_ID NOT IN (28)), NULL, PAYMENT.ORGANIZATION_ID) AS COMPANY_TO,
  IIF((PAYMENT_TYPE.PAYMENT_TYPE_ID NOT IN (28, 6)), NULL, PAYMENT.PERSON_ID) AS PERSON_TO,
  IIf(PAYMENT.COMPANY=117, IIf(TRAINING.CREATE_DATE IS NULL, PAYMENT.PAYMENT_DATE, TRAINING.CREATE_DATE), IIf(PAYMENT.FOR_MONTH Is Null, PAYMENT.PAYMENT_DATE, DateSerial(PAYMENT.FOR_YEAR,PAYMENT.FOR_MONTH,1))) AS PAYMONTH,
  IIf((PAYMENT_TYPE.BANK_OPERATION = TRUE) OR (PAYMENT.CASHLESS = TRUE), 0, IIF(PAYMENT_TYPE.DIRECTION = TRUE, 1, -1) * PAYMENT.SUMMA) AS KASSA,
  IIf(((PAYMENT_TYPE.KASSA_OPERATION = TRUE) OR (PAYMENT_TYPE.BANK_OPERATION = TRUE)) AND (PAYMENT.PAYMENT_TYPE_ID <> 17), IIF(PAYMENT_TYPE.DIRECTION = FALSE, 1, -1) * PAYMENT.SUMMA, 0) AS SAFE,
  IIf((PAYMENT_TYPE.BANK_OPERATION = TRUE) OR (PAYMENT.CASHLESS = FALSE), 0, IIF(PAYMENT_TYPE.DIRECTION = TRUE, 1, -1) * PAYMENT.SUMMA) AS ACCOUNT,
  IIf((PAYMENT_TYPE.BANK_OPERATION = TRUE) OR (PAYMENT_TYPE.KASSA_OPERATION = TRUE) OR ((PAYMENT_TYPE.INVESTMENT = TRUE) AND (PAYMENT.COMPANY <> 117)), 0, IIF(PAYMENT_TYPE.DIRECTION = TRUE, 1, -1) * PAYMENT.SUMMA) AS PROFIT,
  IIF((PAYMENT_TYPE.INVESTMENT = FALSE) OR (PAYMENT.COMPANY=117), 0, IIF(PAYMENT_TYPE.DIRECTION = FALSE, 1, -1) * PAYMENT.SUMMA) AS INVESTMENT,
  IIf((PAYMENT_TYPE.KASSA_OPERATION = FALSE) OR (PAYMENT.PAYMENT_TYPE_ID = 17), 0, IIF(PAYMENT_TYPE.DIRECTION = FALSE, 1, -1) * PAYMENT.SUMMA) AS BALANCE,
  IIf((PAYMENT_TYPE.PAYMENT_TYPE_ID <> 6), 0, PAYMENT.SUMMA) AS DIV_PAID,
  IIf((PAYMENT_TYPE.PAYMENT_TYPE_ID <> 28), 0, PAYMENT.SUMMA) AS LEND,
  IIf((PAYMENT_TYPE.PAYMENT_TYPE_ID <> 30), 0, PAYMENT.SUMMA) AS BANK_EXPENSE
FROM PAYMENT_TYPE INNER JOIN (PAYMENT LEFT JOIN TRAINING ON PAYMENT.TRAINING_ID = TRAINING.TRAINING_ID) ON PAYMENT_TYPE.PAYMENT_TYPE_ID = PAYMENT.PAYMENT_TYPE_ID
