SELECT BUDGET_MONTH_PRE.COMPANY,
  SHAREHOLDER.PERSON_ID,
  BUDGET_MONTH_PRE.BUDMONTH,
  IIf(BUDGET_MONTH_PRE.CLEAR_PROFIT_MONTH<=0,0,Round(BUDGET_MONTH_PRE.CLEAR_PROFIT_MONTH*SHAREHOLDER.SHARE,0)) AS DIV
FROM BUDGET_MONTH_PRE INNER JOIN SHAREHOLDER ON ((BUDGET_MONTH_PRE.COMPANY = SHAREHOLDER.ORGANIZATION_ID)
    AND (DATESERIAL(SHAREHOLDER.FROM_YEAR, SHAREHOLDER.FROM_MONTH,1) <=BUDGET_MONTH_PRE.BUDMONTH)
    AND (BUDGET_MONTH_PRE.BUDMONTH<=(DATESERIAL(IIf(SHAREHOLDER.TO_YEAR IS NULL, 2099, SHAREHOLDER.TO_YEAR), IIf(SHAREHOLDER.TO_MONTH IS NULL, 12, SHAREHOLDER.TO_MONTH),1))));
