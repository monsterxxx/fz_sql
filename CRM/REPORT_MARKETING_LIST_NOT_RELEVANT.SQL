SELECT PERSON.CREATE_DATE AS [Дата добавления],
PERSON.PERSON_ID, PERSON.LASTNAME AS [Фамилия],
PERSON.FIRSTNAME AS [Имя],
PERSON.PATRONYMIC AS [Отчество],
PERSON.BIRTHDAY AS [ДР],
DateDiff("yyyy", PERSON.BIRTHDAY, Date()) AS [Возраст],
IIf([PERSON].[SEX]=-1,"М","Ж") AS [Пол],
IIf([PERSON].[BIRTHDAY] Is Null,IIf([PERSON].[SEX]=-1,"М_НетДР","Ж_НетДР"),IIf(([PERSON].[SEX]=-1),IIf([PERSON].[CREATE_DATE]-[PERSON].[BIRTHDAY]>=5844,"М_Взр","М_Реб"),IIf([PERSON].[CREATE_DATE]-[PERSON].[BIRTHDAY]>=5844,"Ж_Взр","Ж_Реб"))) AS [Пол_Возраст],
IIf(PERSON.TEL_MOB Is Null And PERSON.TEL_WORK Is Null And PERSON.TEL_OTHER Is Null,0,1) AS [Есть телефон],
CLIENT_ADDRESS_MIN.ADDRESS_TYPE AS [Тип Адреса],
CLIENT_ADDRESS_MIN.TOWN AS [Город],
CLIENT_ADDRESS_MIN.METRO_NAME AS [Метро],
PERSON.INFOSOURCE AS [Откуда узнали],
PERSON.COMMERCIAL_PLACE AS [Зона рекламы],
HALL.FULLNAME AS [Подходящий зал],
IIf(PERSON.SOFORCA=True,1,0) AS [Член ФКР],
IIf([PERSON].[POTENTIAL]=True,1,0) AS [Потенциальный клиент],
PERSON.REMIND_DATE AS [Напоминание],
PERSON.REFUSAL_REASON AS [Причина отказа],
PERSON.NOTE AS [Заметки],
CLIENT.CLIENT_ID,
CLIENT_TOTAL_ATTENDANCE.CountCAME AS [Всего посещений],
T1.[Count-CAME] AS [Посещ в этом месяце],
CLIENT_PAYMONTH_FIRST.FIRST_PAYMONTH AS [Первая оплата],
CLIENT_PAYMONTH_LAST.LAST_PAYMONTH AS [Последняя оплата],
CLIENT_PAYMONTH_DISTINCT_COUNT.COUNT_DISTINCT_PAYMONTH AS [Месяцев оплачено],
CLIENT_TOTAL_PAYMENT.PAYMENT_SUMMA AS [Сумма платежей],
REPORT_CLIENT_FIRST_GROUP_PAYMENT.FIRST_PAYMENT_SUMMA AS [Первый платеж],
REPORT_CLIENT_FIRST_GROUP_PAYMENT.FIRST_SPORT AS [Первый спорт],
REPORT_CLIENT_FIRST_GROUP_PAYMENT.FIRST_ORGANIZATION_NAME AS [Первая компания],
REPORT_CLIENT_FIRST_GROUP_PAYMENT.FIRST_GROUP_NAME AS [Первая группа],
REPORT_CLIENT_FIRST_GROUP_PAYMENT.FIRST_TRAINER AS [Первый тренер],
IIf([CLIENT_TOTAL_ATTENDANCE].[CLIENT_ID] Is Not Null, IIf([REPORT_CLIENT_FIRST_GROUP_PAYMENT].[CLIENT_ID] Is Null,1,Null),Null) AS ATT_NO_PAYMENT
FROM (((((((PERSON LEFT JOIN CLIENT_PAYMONTH_LAST ON PERSON.PERSON_ID = CLIENT_PAYMONTH_LAST.PERSON_ID)
LEFT JOIN CLIENT_PAYMONTH_DISTINCT_COUNT ON PERSON.PERSON_ID = CLIENT_PAYMONTH_DISTINCT_COUNT.PERSON_ID)
LEFT JOIN ((((CLIENT LEFT JOIN CLIENT_TOTAL_ATTENDANCE ON CLIENT.CLIENT_ID = CLIENT_TOTAL_ATTENDANCE.CLIENT_ID)
LEFT JOIN (SELECT CLIENT_ID, [Count-CAME] FROM CLIENT_YEAR_MONTH_ATTENDANCE WHERE (FOR_YEAR = year(DATE()) AND FOR_MONTH = MONTH(DATE())))  AS T1 ON CLIENT.CLIENT_ID = T1.CLIENT_ID
          ) LEFT JOIN CLIENT_TOTAL_PAYMENT ON CLIENT.CLIENT_ID = CLIENT_TOTAL_PAYMENT.CLIENT_ID
          ) LEFT JOIN REPORT_CLIENT_FIRST_GROUP_PAYMENT ON CLIENT.CLIENT_ID = REPORT_CLIENT_FIRST_GROUP_PAYMENT.CLIENT_ID
         ) ON PERSON.PERSON_ID = CLIENT.PERSON_ID
        ) LEFT JOIN EMPLOYEE ON PERSON.PERSON_ID = EMPLOYEE.PERSON_ID
       ) LEFT JOIN TRAINER ON PERSON.PERSON_ID = TRAINER.PERSON_ID
      ) LEFT JOIN CLIENT_PAYMONTH_FIRST ON PERSON.PERSON_ID = CLIENT_PAYMONTH_FIRST.PERSON_ID
     ) LEFT JOIN CLIENT_ADDRESS_MIN ON PERSON.PERSON_ID = CLIENT_ADDRESS_MIN.PERSON_ID
   ) LEFT JOIN HALL ON PERSON.HALL_ID = HALL.HALL_ID
WHERE (((EMPLOYEE.PERSON_ID) Is Null) AND ((TRAINER.PERSON_ID) Is Null));
