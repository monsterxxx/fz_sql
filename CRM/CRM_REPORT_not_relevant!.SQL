SELECT CRM_UNITED.COLUMN AS [Графа],
  CRM_UNITED.COLUMN1 AS [Графа1],
  ORGANIZATION.FULLNAME AS [Компания],
  CRM_UNITED.PERSON_ID,
  PERSON.LASTNAME & " " & PERSON.FIRSTNAME AS [Клиент],
  PERSON.INFOSOURCE AS [Откуда узнали],
  PERSON.REFUSAL_REASON AS [Причина отказа],
  IIF(HALL.FULLNAME IS NOT NULL, HALL.FULLNAME, IIF(CLIENT_ADDRESS_MIN.METRO_NAME IS NOT NULL, CLIENT_ADDRESS_MIN.METRO_NAME, CLIENT_ADDRESS_MIN.TOWN)) AS [Подходящий зал или метро],
  CRM_UNITED.ATTMONTH AS [Месяц]
FROM ((((
SELECT COLUMN, COLUMN1, COMPANY, PERSON_ID, PAYMONTH FROM CRM_PAYMENT
UNION ALL
SELECT * FROM CRM_DEBT
UNION ALL
SELECT * FROM CRM_FREE
UNION ALL
SELECT * FROM CRM_TRY
UNION ALL
SELECT 'Пришли', CRM_NEW_PAYMENT.* FROM CRM_NEW_PAYMENT
UNION ALL
SELECT 'Пришли', 'Вернулись', COMPANY, PERSON_ID, CALMONTH FROM CRM_GONE_RETURN RETURN WHERE (THISMONTHPAYDEBT IS NOT NULL) AND (LASTMONTHPAYDEBT IS NULL) AND (FIRSTPAY IS NULL)
UNION ALL
SELECT 'Ушли', 'Ушли', COMPANY, PERSON_ID, CALMONTH FROM CRM_GONE_RETURN RETURN WHERE (THISMONTHPAYDEBT IS NULL) AND (LASTMONTHPAYDEBT IS NOT NULL) AND (LASTPAYDEBT IS NOT NULL)
UNION ALL
SELECT 'Ушли', 'Ушли. Потом вернулись', COMPANY, PERSON_ID, CALMONTH FROM CRM_GONE_RETURN RETURN WHERE (THISMONTHPAYDEBT IS NULL) AND (LASTMONTHPAYDEBT IS NOT NULL) AND (LASTPAYDEBT IS NULL)
UNION ALL
SELECT 'Добавлены в базу', 'Добавлены в базу', NULL, PERSON_ID, CREATE_DATE - DAY(CREATE_DATE) + 1 FROM PERSON WHERE (REFUSAL_REASON <> 'Не является клиентом') OR (REFUSAL_REASON IS NULL)
) AS CRM_UNITED LEFT JOIN ORGANIZATION ON ORGANIZATION.ORGANIZATION_ID = CRM_UNITED.ORGANIZATION_ID)
  LEFT JOIN PERSON ON PERSON.PERSON_ID = CRM_UNITED.PERSON_ID)
  LEFT JOIN HALL ON HALL.HALL_ID = PERSON.HALL_ID)
  LEFT JOIN CLIENT_ADDRESS_MIN ON CLIENT_ADDRESS_MIN.PERSON_ID = CRM_UNITED.PERSON_ID;
